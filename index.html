<!DOCTYPE html>
<html>
<head>
    <!-- Indica o tipo de documento HTML5 para os navegadores -->
    <title>Dashboard-Boston</title> <!-- Define o título da página que aparece na aba do navegador -->
    <meta charset="UTF-8"> <!-- Define a codificação de caracteres para exibir corretamente acentos e outros caracteres especiais -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Faz a página se ajustar para diferentes tamanhos de tela (importante para dispositivos móveis) -->
    
    <!-- Link para uma biblioteca de ícones (Font Awesome) que pode ser usada no layout -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

    <!-- Início da seção de CSS para definir o estilo da página -->
    <style>
        /* CSS define o estilo visual (cores, tamanhos, posições) */
        
        /* Define o estilo global para todos os elementos, removendo margens e preenchimentos padrão */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        /* Estilo do corpo da página, incluindo fonte, cor de fundo e alinhamento do conteúdo */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
            padding: 2vh;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
        }

        /* Estilo da div principal da dashboard */
        .dashboard {
            position: relative;
            width: 100vw;
            height: 90vh;
            max-width: 1400px;
            background: white;
            padding: 1vh 2vw;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            overflow-y: auto;
        }

        /* Estilo do cabeçalho da dashboard */
        .dashboard-header {
            text-align: center;
            margin-bottom: 2vh;
            font-weight: bold;
            font-size: 2.5vh;
            color: black;
        }

        /* Estilos para diferentes status, como pendente, cancelado, finalizado e atrasado */
        .status-pendente {
            background-color: #FF9800;
            color: white;
            font-weight: bold;
            padding: 5px;
            border-radius: 4px;
        }

        /* Define uma animação de "piscar" para linhas de status atrasado */
        @keyframes blink {
            0% { background-color: rgba(255, 0, 0, 0.1); }
            50% { background-color: white; }
            100% { background-color: rgba(255, 0, 0, 0.1); }
        }

        /* Estilo para a tabela onde os dados serão exibidos */
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 1.8vh;
        }
    </style>
</head>

<!-- Corpo do HTML, onde o conteúdo visível da página é definido -->
<body>
    <div class="dashboard">
        <!-- Exibe uma imagem no canto superior direito da dashboard -->
        <div style="position: absolute; top: 2vh; right: 2vw;">
            <img src="LogoCEVA.jpg" alt="Logo CEVA" style="height: 65px;">
        </div>

        <!-- Cabeçalho principal da dashboard -->
        <div class="dashboard-header">
            <h1>PAINEL DE PRIORIDADES</h1>
        </div>

        <!-- Elementos que mostram a última e a próxima atualização de dados -->
        <div id="lastUpdate"></div>
        <div id="nextUpdate"></div>

        <!-- Container onde a tabela de dados será exibida -->
        <div class="table-container" id="tableContainer"></div>
    </div>

    <!-- Div que mostra um spinner de "carregando" durante o carregamento dos dados -->
    <div id="loading" class="loading">
        <div class="loading-spinner"></div>
    </div>

    <!-- Início do JavaScript para funcionalidade dinâmica da página -->
    <script>
        // Constante com a URL da API para buscar dados
        const API_URL = 'https://script.google.com/macros/s/AKfycbwG_4QWkBGH1g2tfSNVmViLNncHFln4RDuoUYRihmnRLJ7a1-axEtRxOlfAFhVdMGQ4/exec';
        
        // Array para armazenar os dados recebidos da API
        let allData = [];

        // Função que exibe ou esconde o spinner de carregamento
        function toggleLoading(show) {
            document.getElementById('loading').style.display = show ? 'flex' : 'none';
        }

        // Função para buscar dados da API
        async function fetchData() {
            toggleLoading(true);
            try {
                const response = await fetch(API_URL); // Busca dados da API
                const result = await response.json(); // Converte a resposta em JSON

                if (result.status === 'success' && result.data) {
                    allData = result.data; // Salva os dados na variável allData
                    displayData(); // Exibe os dados na tabela
                    updateLastUpdate(); // Atualiza a data/hora da última atualização
                } else {
                    throw new Error(result.message || 'Erro ao carregar dados'); // Exibe erro se algo deu errado
                }
            } catch (error) {
                showStatus(`Erro: ${error.message}`, 'error'); // Exibe uma mensagem de erro
                console.error('Erro:', error); // Loga o erro no console
            } finally {
                toggleLoading(false); // Esconde o spinner
            }
        }

        // Função para exibir dados na tabela
        function displayData() {
            if (!allData || allData.length === 0) {
                document.getElementById('tableContainer').innerHTML = '<p>Nenhum dado encontrado</p>';
                return;
            }

            // Definição de colunas específicas que queremos mostrar na tabela
            const columnsToDisplay = [
                'Data solicitada',
                'Nº da delivery',
                'Data e hora do corte',
                'Solicitante',
                'Status',
                'Motivo de cancelamento'
            ];

            // HTML básico da tabela que contém o cabeçalho
            let tableHtml = '<table><tr>';
            columnsToDisplay.forEach(col => tableHtml += `<th>${col}</th>`);
            tableHtml += '</tr>';

            // Adiciona uma linha para cada dado da API na tabela
            allData.forEach(row => {
                tableHtml += `<tr>`;
                columnsToDisplay.forEach(col => {
                    let cellValue = row[col] || '';
                    tableHtml += `<td>${cellValue}</td>`;
                });
                tableHtml += '</tr>';
            });

            // Exibe o HTML da tabela na página
            document.getElementById('tableContainer').innerHTML = tableHtml;
        }

        // Função para atualizar o campo de última atualização
        function updateLastUpdate() {
            const now = new Date();
            document.getElementById('lastUpdate').textContent = `Última atualização: ${now.toLocaleDateString('pt-BR')} - ${now.toLocaleTimeString('pt-BR')}`;
        }

        // Carrega dados ao abrir a página e a cada 30 segundos
        fetchData();
        setInterval(fetchData, 30000);
    </script>
</body>
</html>
